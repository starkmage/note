# Webpacké¢„åŠ è½½åŠ¨æ€åŠ è½½çš„bundle

**é¢„åŠ è½½æç¤º**ï¼š
å¯¹å…³é”®å¼‚æ­¥ chunk ä½¿ç”¨ `<link rel="preload">` æˆ– `webpackPreload` æå‰åŠ è½½ï¼š

```
import(/* webpackPreload: true */ './CriticalModal.js');
```

# è‹¥å¼‚æ­¥æ¨¡å—ä¸­åŒæ­¥å¼•ç”¨äº†ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ lodashï¼‰ï¼ŒWebpack ä¼šå¦‚ä½•å¤„ç†ï¼Ÿ

åœ¨ Webpack ä¸­ï¼Œå½“ä¸€ä¸ªå¼‚æ­¥æ¨¡å—ï¼ˆé€šè¿‡åŠ¨æ€ `import()` åŠ è½½ï¼‰ä¸­åŒæ­¥å¼•ç”¨ç¬¬ä¸‰æ–¹åº“ï¼ˆå¦‚ä½¿ç”¨ `import _ from 'lodash';` ï¼‰æ—¶ï¼ŒWebpack çš„å¤„ç†å–å†³äºä»£ç åˆ†å‰²ï¼ˆcode splittingï¼‰å’Œä¼˜åŒ–é…ç½®ï¼Œç‰¹åˆ«æ˜¯ `SplitChunksPlugin` çš„ä½œç”¨ã€‚æ€»ä½“ä¸Šï¼ŒWebpack ä¼šå°†è¯¥ç¬¬ä¸‰æ–¹åº“è§†ä¸ºæ¨¡å—ä¾èµ–ï¼Œå¹¶æ ¹æ®é…ç½®å†³å®šå…¶æ‰“åŒ…ä½ç½®ï¼Œä»¥å®ç°é«˜æ•ˆçš„ bundle åˆ†ç¦»å’Œé¿å…ä»£ç é‡å¤ã€‚ä¸‹é¢æˆ‘è¯¦ç»†è§£é‡Šï¼š

### 1. **åŸºæœ¬æ‰“åŒ…è¡Œä¸º**
   - **å¼‚æ­¥æ¨¡å—çš„å¤„ç†**ï¼šåŠ¨æ€ `import()` ä¼šè§¦å‘ä»£ç åˆ†å‰²ï¼ŒWebpack å°†å¼‚æ­¥æ¨¡å—åŠå…¶åŒæ­¥ä¾èµ–ï¼ˆåŒ…æ‹¬ lodashï¼‰æ‰“åŒ…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„ chunkï¼ˆbundle æ–‡ä»¶ï¼‰ä¸­ã€‚è¿™ä¸ª chunk åªåœ¨éœ€è¦æ—¶åŠ è½½ï¼ˆæ‡’åŠ è½½ï¼‰ï¼Œä¸ä¼šåŒ…å«åœ¨ä¸» bundle ä¸­ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ çš„ä»£ç æ˜¯ï¼š

     ```javascript
     // main.js (ä¸»å…¥å£)
     import('./asyncModule').then(module => module.default());
     
     // asyncModule.js (å¼‚æ­¥æ¨¡å—)
     import _ from 'lodash';  // åŒæ­¥å¼•ç”¨ lodash
     export default function() { _.debounce(/* ... */); }
     ```
     Webpack ä¼šç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„ chunkï¼ˆå¦‚ `asyncModule.chunk.js`ï¼‰ï¼Œå…¶ä¸­åŒ…å« asyncModule.js çš„ä»£ç å’Œ lodash çš„ä»£ç ï¼ˆå¦‚æœ lodash æœªè¢«æå–ï¼‰ã€‚
     
   - **ç¬¬ä¸‰æ–¹åº“çš„ä½ç½®**ï¼šé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœ lodash åªåœ¨è¯¥å¼‚æ­¥æ¨¡å—ä¸­ä½¿ç”¨ï¼ŒWebpack ä¼šå°†å…¶ç›´æ¥æ‰“åŒ…åˆ°å¼‚æ­¥ chunk ä¸­ï¼Œè€Œä¸æ˜¯ä¸» bundleã€‚è¿™ç¡®ä¿äº†æŒ‰éœ€åŠ è½½ï¼Œä½†å¦‚æœ lodash è¾ƒå¤§ï¼Œå¯èƒ½ä¼šå¢åŠ å¼‚æ­¥ chunk çš„ä½“ç§¯ã€‚

### 2. **SplitChunksPlugin çš„ä½œç”¨ï¼ˆé»˜è®¤å¯ç”¨ï¼‰**
   - Webpack çš„ `optimization.splitChunks` é…ç½®ï¼ˆåŸºäº SplitChunksPluginï¼‰ä¼šè‡ªåŠ¨ä¼˜åŒ–ç¬¬ä¸‰æ–¹åº“çš„å¤„ç†ï¼Œç‰¹åˆ«æ˜¯æ¥è‡ª `node_modules` çš„æ¨¡å—å¦‚ lodashã€‚
     é»˜è®¤é…ç½®ä¸‹ï¼ˆæˆ–æ˜¾å¼è®¾ç½® `chunks: 'all'` æˆ– `'async'`ï¼‰ï¼š
     - å¦‚æœ lodash åªåœ¨å¼‚æ­¥æ¨¡å—ä¸­ä½¿ç”¨ï¼Œå®ƒå¯èƒ½ä»æ‰“åŒ…åˆ°å¼‚æ­¥ chunk ä¸­ã€‚
     - ä½†å¦‚æœ lodash è¢«å¤šä¸ª chunk å…±äº«ï¼ˆä¾‹å¦‚ï¼Œä¸»æ¨¡å—å’Œå¼‚æ­¥æ¨¡å—éƒ½ä½¿ç”¨å®ƒï¼‰ï¼ŒWebpack ä¼šå°†å…¶æå–åˆ°å•ç‹¬çš„ vendor chunkï¼ˆå¦‚ `vendors~chunk.js` æˆ–è‡ªå®šä¹‰åç§°ï¼‰ï¼Œä»¥é¿å…é‡å¤ä»£ç ã€‚é˜ˆå€¼ï¼ˆå¦‚ `minSize: 30000` å­—èŠ‚ï¼‰ä¼šå†³å®šæ˜¯å¦æå–ï¼›lodash é€šå¸¸æ»¡è¶³æ­¤æ¡ä»¶ï¼Œä¼šè¢«åˆ†ç¦»åˆ° vendor chunkã€‚
     - ç¤ºä¾‹è¾“å‡ºï¼šæ„å»ºåå¯èƒ½ç”Ÿæˆï¼š
       - `main.bundle.js` ï¼ˆä¸» chunkï¼ŒåŒ…å«åŠ¨æ€ import çš„é€»è¾‘ï¼‰
       - `vendors-node_modules_lodash_lodash_js.chunk.js` ï¼ˆæå–çš„ lodash chunkï¼‰
       - `asyncModule.chunk.js` ï¼ˆå¼‚æ­¥æ¨¡å— chunkï¼Œä¾èµ– vendors chunkï¼‰
     
   - **é…ç½®å½±å“**ï¼š
     - å¦‚æœè®¾ç½® `optimization.splitChunks.cacheGroups.vendors: { test: /[\\/]node_modules[\\/]/, name: 'vendors', chunks: 'all' }`ï¼ŒWebpack ä¼šå¼ºåˆ¶å°†æ‰€æœ‰ç¬¬ä¸‰æ–¹åº“æå–åˆ° vendors bundleï¼Œå³ä½¿åœ¨å¼‚æ­¥ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™å¯¹æ€§èƒ½ä¼˜åŒ–ç‰¹åˆ«æœ‰ç”¨ï¼Œå› ä¸º vendors å¯ä»¥è¢«æµè§ˆå™¨ç¼“å­˜ã€‚
     - å¯¹äºå¼‚æ­¥ä¸“å±çš„åº“ï¼Œè®¾ç½® `chunks: 'async'` ä¼šåªé’ˆå¯¹åŠ¨æ€å¯¼å…¥çš„ä¾èµ–è¿›è¡Œåˆ†å‰²ï¼Œè€Œä¸å½±å“åˆå§‹åŠ è½½ã€‚

### 3. **æ½œåœ¨é—®é¢˜ä¸ä¼˜åŒ–å»ºè®®**
   - **ä»£ç é‡å¤**ï¼šå¦‚æœæœªæ­£ç¡®é…ç½® SplitChunksï¼Œlodash å¯èƒ½åœ¨å¤šä¸ªå¼‚æ­¥ chunk ä¸­é‡å¤æ‰“åŒ…ï¼Œå¯¼è‡´æ€»ä½“ bundle å¤§å°å¢åŠ ã€‚è§£å†³ï¼šå§‹ç»ˆå¯ç”¨å¹¶è°ƒä¼˜ SplitChunksPluginã€‚
   - **å¤–éƒ¨åŒ–ï¼ˆExternalsï¼‰**ï¼šå¦‚æœæƒ³é¿å…æ‰“åŒ… lodashï¼Œå¯ä»¥é€šè¿‡ `externals: { lodash: '_' }` é…ç½®å°†å…¶æ’é™¤ï¼Œè®©å®ƒé€šè¿‡ CDN åŠ è½½ï¼Œä½†è¿™ä¼šå°†ä¾èµ–è½¬ä¸ºè¿è¡Œæ—¶å¤–éƒ¨ä¾èµ–ï¼Œä¸å†æ‰“åŒ…ã€‚
   - **Tree Shaking**ï¼šWebpack ä¼šå°è¯• tree-shake lodashï¼Œåªæ‰“åŒ…ä½¿ç”¨çš„éƒ¨åˆ†ï¼ˆå¦‚åªç”¨ debounce æ—¶ï¼ŒåªåŒ…å«ç›¸å…³ä»£ç ï¼‰ã€‚
   - **ç‰ˆæœ¬å…¼å®¹**ï¼šåœ¨ Webpack 5+ ä¸­ï¼Œmodule federation å¯ä»¥è¿›ä¸€æ­¥å¤„ç†å…±äº«ä¾èµ–ï¼Œä½†å¯¹äºæ ‡å‡†åœºæ™¯ï¼Œcode splitting å°±å¤Ÿç”¨ã€‚

æ€»ç»“ï¼šWebpack ä¼šå°† lodash æ‰“åŒ…åˆ°ç›¸å…³å¼‚æ­¥ chunk ä¸­ï¼Œä½† SplitChunksPlugin ä¼šæ™ºèƒ½æå–åˆ° vendors chunk ä»¥ä¼˜åŒ–åŠ è½½å’Œç¼“å­˜ã€‚å¦‚æœä½ çš„ webpack.config.js ä¸­æœ‰ç‰¹å®šé…ç½®ï¼Œé»˜è®¤è¡Œä¸ºå€¾å‘äºæå–ä»¥å‡å°‘é‡å¤ã€‚å¦‚æœä½ é‡åˆ°å…·ä½“æ„å»ºé—®é¢˜ï¼Œæ£€æŸ¥ `webpack --profile --json > stats.json` è¾“å‡ºåˆ†æä¾èµ–æ ‘ã€‚

# Webpack ä¼˜åŒ–é¡¹ç›®æ€§èƒ½çš„æ–¹æ³•

------

## ğŸ§  ä¸€ã€æ„å»ºäº§ç‰©ä¼˜åŒ–ï¼ˆå‡å° bundle ä½“ç§¯ï¼‰

âœ… 1. **Tree Shakingï¼ˆæ‘‡æ ‘ä¼˜åŒ–ï¼‰**

- ç§»é™¤æœªä½¿ç”¨çš„ä»£ç ï¼ˆES Module ä¸“å±ç‰¹æ€§ï¼‰

```js
// åªå¼•å…¥ lodash çš„ç‰¹å®šå‡½æ•°
import debounce from 'lodash/debounce';
```

> é¿å… `import _ from 'lodash'`

------

âœ… 2. **ä»£ç åˆ†å‰²ï¼ˆCode Splittingï¼‰**

- ä½¿ç”¨ `SplitChunksPlugin` æ‹†åˆ†å…¬å…±ä»£ç ä¸å¼‚æ­¥æ¨¡å—
- è·¯ç”±çº§æˆ–ç»„ä»¶çº§æ‡’åŠ è½½

```js
const Chart = React.lazy(() => import('./Chart'));
// webpack.config.js
optimization: {
  splitChunks: {
    chunks: 'all',
    cacheGroups: {
      vendors: {
        test: /[\\/]node_modules[\\/]/,
        name: 'vendors',
        chunks: 'all'
      }
    }
  }
}
```

------

âœ… 3. **æ‡’åŠ è½½ï¼ˆLazy Loadï¼‰ä¸æŒ‰éœ€åŠ è½½**

- åŠ¨æ€ `import()` åŠ è½½ä¸å¸¸ç”¨æ¨¡å—

```js
button.addEventListener('click', async () => {
  const { exportPDF } = await import('./pdfUtils');
  exportPDF();
});
```

------

âœ… 4. **ä½¿ç”¨ç”Ÿäº§æ¨¡å¼ï¼ˆ`mode: 'production'`ï¼‰**

- è‡ªåŠ¨å¼€å¯å‹ç¼©ã€Tree Shakingã€ä½œç”¨åŸŸæå‡ç­‰ä¼˜åŒ–

------

âœ… 5. **å‹ç¼©ä»£ç **

- JS å‹ç¼©ï¼š`TerserPlugin`ï¼ˆé»˜è®¤ï¼‰
- CSS å‹ç¼©ï¼š`css-minimizer-webpack-plugin`
- HTML å‹ç¼©ï¼š`html-webpack-plugin` + `minify: true`

------

## âš™ï¸ äºŒã€æ„å»ºé€Ÿåº¦ä¼˜åŒ–

âœ… 1. **ä½¿ç”¨ `cache: true` ç¼“å­˜ loader ç»“æœ**

```js
module: {
  rules: [
    {
      test: /\.js$/,
      use: ['babel-loader?cacheDirectory']
    }
  ]
}
```

------

âœ… 2. **å¤šçº¿ç¨‹ç¼–è¯‘ï¼ˆ`thread-loader`ï¼‰**

```js
use: ['thread-loader', 'babel-loader']
```

âš ï¸ `thread-loader` å¿…é¡»æ”¾åœ¨å…¶ä»– loader **å‰é¢**ï¼ˆå³åœ¨ use æ•°ç»„ä¸­é å‰ï¼‰ï¼Œå®ƒåªè´Ÿè´£æŠŠæ–‡ä»¶äº¤ç»™ worker çº¿ç¨‹å¤„ç†ï¼ŒçœŸæ­£ç¼–è¯‘çš„æ˜¯åé¢çš„ loaderã€‚

é€šå¸¸ç”¨äºä»¥ä¸‹ loader ä¹‹å‰ï¼š

- `babel-loader`
- `ts-loader`ï¼ˆæ³¨æ„è¦é…ç½®æˆ `happyPackMode`ï¼‰

ä½¿ç”¨thread-loaderçš„**loader è¦æ”¯æŒå¤šçº¿ç¨‹**ï¼šä¸æ˜¯æ‰€æœ‰ loader éƒ½æ”¯æŒåœ¨ worker çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œå¦‚ `style-loader` å°±ä¸æ”¯æŒã€‚

**ä¸é€‚ç”¨äº I/O å¯†é›†å‹**ï¼šå¦‚ `file-loader`ã€`url-loader` ç­‰ä¸å»ºè®®ä½¿ç”¨ `thread-loader`ã€‚

**å°é¡¹ç›®æ…ç”¨**ï¼šçº¿ç¨‹åˆ›å»ºæœ‰æˆæœ¬ï¼Œæ–‡ä»¶é‡å°çš„é¡¹ç›®åè€Œå¯èƒ½æ›´æ…¢ã€‚

------

âœ… 3. **DLLPlugin / Module Federationï¼ˆé¢„ç¼–è¯‘ä¾èµ–åº“ï¼‰**

- å°†ä¸å¸¸æ”¹åŠ¨çš„åº“ï¼ˆå¦‚ Reactã€Lodashï¼‰æ‰“æˆç‹¬ç«‹ DLLï¼Œå‡å°‘é‡å¤ç¼–è¯‘

------

âœ… 4. **ç¼©å°æ‰“åŒ…èŒƒå›´**

- å‡å°‘ `include` æˆ– `exclude` åŒ¹é…èŒƒå›´

```js
// ä¼˜åŒ– loader ä½œç”¨åŸŸ
include: path.resolve(__dirname, 'src')
```

------

## ğŸŒ ä¸‰ã€èµ„æºä¼˜åŒ–ï¼ˆå›¾ç‰‡ / æ ·å¼ç­‰ï¼‰

âœ… 1. **å›¾ç‰‡å‹ç¼©ï¼ˆimage-webpack-loader / ä½¿ç”¨ WebPï¼‰**

```js
test: /\.(png|jpe?g|gif)$/,
use: ['file-loader', 'image-webpack-loader']
```

------

âœ… 2. **ä½¿ç”¨ CSS Modules + Tree Shaking çš„ CSS Loader**

- é¿å…å…¨å±€ CSS å†²çªï¼Œæœªä½¿ç”¨æ ·å¼è‡ªåŠ¨å‰”é™¤

------

âœ… 3. **CDN åŠ é€Ÿç¬¬ä¸‰æ–¹åº“**

- å°† Reactã€lodash ç­‰ä¸é¢‘ç¹å˜åŒ–çš„åº“å¼•å…¥ CDNï¼Œå‡å°ä¸» bundle

```html
<script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.production.min.js"></script>
```

------

## ğŸ“¦ å››ã€è¿è¡Œæ—¶ä¼˜åŒ–

âœ… 1. **é¢„åŠ è½½ / é¢„å–èµ„æº**

```js
import(/* webpackPrefetch: true */ './HeavyComponent');
```

------

âœ… 2. **ç§»é™¤ console / debugger**

```js
// terser-webpack-plugin é…ç½®ä¸­ç§»é™¤ console
terserOptions: {
  compress: {
    drop_console: true,
    drop_debugger: true,
  }
}
```

------

## ğŸ§° äº”ã€åˆ†æä¸ç›‘æ§

âœ… 1. **ä½¿ç”¨ `webpack-bundle-analyzer` åˆ†æä½“ç§¯**

```bash
npx webpack-bundle-analyzer dist/bundle.js
```

------

âœ… 2. **SourceMap æ§åˆ¶ï¼ˆå¼€å‘ / ç”Ÿäº§åˆ†å¼€é…ç½®ï¼‰**

- å¼€å‘ï¼š`devtool: 'eval-source-map'`
- ç”Ÿäº§ï¼š`devtool: false` æˆ– `source-map`

# ç½‘ç»œä¼ è¾“ä¼˜åŒ–çš„æ–¹æ³•

------

## âœ… 1. **Compression & Encoding**

- Enable **Gzip** or **Brotli** compression for HTTP responses
- Use modern image formats like **WebP** or **AVIF**
- Minify HTML, CSS, and JavaScript to reduce payload size

------

## âœ… 2. **Caching Strategies**

- Implement **strong caching** using `Cache-Control` and `Expires`
- Use **conditional caching** with `ETag` and `Last-Modified`

------

## âœ… 3. **Protocol & Connection Optimization**

- Use **HTTP/2** to support multiplexing and header compression

------

## âœ… 4. **Request Optimization**

- Reduce number of requests via bundling, image sprites, or SVG sprites
- Minimize request payloads (e.g., pagination, selective fields)
- Implement **lazy loading** and **code splitting** for on-demand delivery

------

## âœ… 5. **CDN **

- Serve static assets via **CDNs** to reduce latency